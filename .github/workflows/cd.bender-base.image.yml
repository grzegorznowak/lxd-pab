---

name: CD | Build Base Image for Bender

on:
  # Triggers the workflow on push or pull request events but only for the main branch
  # do not trigger for documentation changes
  push:
    branches: [ main ]
    paths:
      - 'images/bender-base/**'

jobs:
  lint:

    runs-on: ubuntu-20.04

    steps:
      - uses: actions/checkout@v2
      - name: install buildah dependencies
        run: |
          sh -c "echo 'deb http://download.opensuse.org/repositories/devel:/kubic:/libcontainers:/stable/x${ID^}_${VERSION_ID}/ /' > /etc/apt/sources.list.d/devel:kubic:libcontainers:stable.list"
          wget -nv https://download.opensuse.org/repositories/devel:kubic:libcontainers:stable/x${ID^}_${VERSION_ID}/Release.key -O Release.key
          apt-key add - < Release.key
          apt-get update -qq
          apt-get -qq -y install buildah
          apt install -y buildah
      - name: build the base image
        run: |
          buildah build -t bender-base images/denber-base